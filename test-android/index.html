<!doctype html><html lang=en><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1,viewport-fit=cover" name=viewport><meta content=yes name=mobile-web-app-capable><meta content=yes name=apple-mobile-web-app-capable><meta content=black-translucent name=apple-mobile-web-app-status-bar-style><meta content=landscape name=screen-orientation><title>PulseQuest</title><style>:root{--card:rgba(255, 255, 255, 0.06);--card2:rgba(255, 255, 255, 0.09);--stroke:rgba(255, 255, 255, 0.12);--text:rgba(255, 255, 255, 0.92);--muted:rgba(255, 255, 255, 0.65);--good:#2ee59d;--warn:#ff5c5c;--beacon:#ffd166;--accent:#6ca8ff;--empty:#0d2a3a;--wall:#151525;--hazard:#3a1515;--beaconBg:#2a2510;--sat:env(safe-area-inset-top, 0px);--sar:env(safe-area-inset-right, 0px);--sab:env(safe-area-inset-bottom, 0px);--sal:env(safe-area-inset-left, 0px)}*{margin:0;padding:0;box-sizing:border-box}body,html{width:100%;height:100vh;height:100dvh;margin:0;padding:0;overflow:hidden;position:fixed;overscroll-behavior:none;touch-action:none;-webkit-tap-highlight-color:transparent;-webkit-user-select:none;user-select:none}body{min-height:100vh;min-height:100dvh;color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;background:radial-gradient(ellipse at 50% 30%,#0a1628 0,#070a16 50%,#030508 100%)}.shell{max-width:900px;width:100%;height:100vh;height:100dvh;margin:0 auto;padding:max(12px,var(--sat)) max(12px,var(--sar)) max(12px,var(--sab)) max(12px,var(--sal));display:flex;flex-direction:column;box-sizing:border-box;overflow:hidden;touch-action:manipulation;-webkit-user-select:none;user-select:none}.card{flex:1;display:flex;flex-direction:column;min-height:0;background:var(--card);border:1px solid var(--stroke);border-radius:20px;box-shadow:0 20px 70px rgba(0,0,0,.45);backdrop-filter:blur(12px);overflow:hidden}.hud{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--stroke)}.hud .title{font-weight:800;font-size:18px;color:var(--beacon)}.pill{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;border:1px solid var(--stroke);background:var(--card2);color:var(--muted);font-size:12px}.dot{width:8px;height:8px;border-radius:999px;background:var(--warn)}.dot.ok{background:var(--good);box-shadow:0 0 12px rgba(46,229,157,.6);animation:pulse 2s infinite}@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}.chips{display:flex;gap:6px}.objective{text-align:center;padding:10px;font-size:14px;color:var(--muted);border-bottom:1px solid var(--stroke)}.objective strong{color:var(--beacon);font-size:16px}.stage{flex:1;min-height:0;padding:8px;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative;overflow:hidden}#grid{display:grid;grid-template-columns:repeat(21,1fr);gap:1px;padding:6px;background:rgba(0,0,0,.4);border-radius:12px;border:1px solid var(--stroke);box-shadow:0 8px 32px rgba(0,0,0,.5);position:relative;max-width:100%;aspect-ratio:21/7}.cell{width:100%;aspect-ratio:1;max-width:36px;max-height:36px;border-radius:4px;display:flex;align-items:center;justify-content:center;position:relative;transition:all .3s;border:1px solid transparent}.cell.E{background:var(--empty);border-color:rgba(46,229,157,.12)}.cell.W{background:var(--wall);border-color:rgba(255,255,255,.08);background-image:repeating-linear-gradient(45deg,transparent,transparent 5px,rgba(255,255,255,.03) 5px,rgba(255,255,255,.03) 10px)}.cell.H{background:var(--hazard);border-color:rgba(255,92,92,.25)}.cell.B{background:var(--beaconBg);border-color:rgba(255,209,102,.35)}.icon{font-size:18px;filter:drop-shadow(0 2px 4px rgba(0, 0, 0, .5));transition:opacity .3s}.cell.fog .icon{opacity:.08}.cell.W .icon{opacity:.4}.player{font-size:20px;color:#fff;filter:drop-shadow(0 0 8px var(--accent)) drop-shadow(0 0 16px var(--accent));z-index:5;animation:playerGlow 1.5s infinite}@keyframes playerGlow{0%,100%{filter:drop-shadow(0 0 12px var(--accent)) drop-shadow(0 0 24px var(--accent))}50%{filter:drop-shadow(0 0 18px var(--accent)) drop-shadow(0 0 36px var(--accent))}}.cell.B::after{content:"";position:absolute;inset:-4px;border-radius:14px;box-shadow:0 0 30px rgba(255,209,102,.7),0 0 60px rgba(255,209,102,.4),inset 0 0 20px rgba(255,209,102,.3);animation:beaconPulse .8s infinite;pointer-events:none}@keyframes beaconPulse{0%,100%{opacity:.5;transform:scale(.95);box-shadow:0 0 30px rgba(255,209,102,.7),0 0 60px rgba(255,209,102,.4)}50%{opacity:1;transform:scale(1.08);box-shadow:0 0 50px #ffd166,0 0 100px rgba(255,209,102,.6),0 0 150px rgba(255,209,102,.3)}}.cell.H::before{content:"";position:absolute;inset:0;border-radius:10px;background:radial-gradient(circle at 30% 30%,rgba(255,100,100,.2),transparent 50%),radial-gradient(circle at 70% 70%,rgba(255,100,100,.15),transparent 40%);animation:hazardShimmer .8s infinite alternate}@keyframes hazardShimmer{0%{opacity:.5}100%{opacity:1}}.cell.fog{opacity:.15;filter:blur(2px)}.cell.scan{animation:scanFlash .6s}@keyframes scanFlash{0%{box-shadow:0 0 0 4px var(--accent),0 0 20px var(--accent)}100%{box-shadow:none}}.ping{position:absolute;border-radius:50%;border:2px solid var(--accent);opacity:0;pointer-events:none;left:50%;top:50%;transform:translate(-50%,-50%)}.ping.active{animation:pingExpand .8s ease-out forwards}@keyframes pingExpand{0%{width:30px;height:30px;opacity:.9}100%{width:280px;height:280px;opacity:0}}#haptics{height:24px;background:rgba(0,0,0,.3);border-radius:6px;display:flex;gap:2px;padding:3px;width:100%;max-width:380px;border:1px solid var(--stroke)}.hpulse{flex:0 0 32px;background:rgba(255,255,255,.1);border-radius:4px;transition:all .15s}.hpulse.on{background:var(--accent);box-shadow:0 0 10px var(--accent)}.controls{padding:8px 12px;border-top:1px solid var(--stroke);flex-shrink:0}.dock{display:flex;flex-wrap:wrap;gap:6px;justify-content:center;padding:8px;background:rgba(255,255,255,.03);border-radius:12px;border:1px solid var(--stroke)}.btn{min-width:70px;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.14);background:rgba(255,255,255,.07);color:var(--text);font-weight:600;font-size:13px;cursor:pointer;transition:all .12s;display:flex;flex-direction:column;align-items:center;gap:2px;touch-action:manipulation}.btn:hover{background:rgba(255,255,255,.12);box-shadow:0 0 0 2px rgba(108,168,255,.25)}.btn:active{transform:scale(.96);background:rgba(108,168,255,.2)}.btn small{font-size:10px;color:var(--muted);font-weight:400}.btn-group{display:flex;gap:6px}.settings{display:flex;gap:8px;justify-content:center;padding:12px;flex-wrap:wrap}.settings button,.settings label,.settings select{font-size:12px;color:var(--muted);background:var(--card2);padding:6px 10px;border-radius:8px;border:1px solid var(--stroke);cursor:pointer}.settings input{margin-right:4px}button,input,select{font-size:16px!important}#train{max-height:0;overflow:hidden;transition:max-height .3s}#train.open{max-height:100px}.train-inner{padding:12px;display:flex;gap:6px;flex-wrap:wrap;justify-content:center;border-top:1px solid var(--stroke)}.train-inner button{padding:8px 12px;border-radius:8px;border:1px solid var(--stroke);background:var(--card2);color:var(--text);cursor:pointer;font-size:12px}.train-inner p{width:100%;text-align:center;font-size:11px;color:var(--muted);margin-top:4px}#overlay{position:fixed;inset:0;background:rgba(7,10,22,.92);display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;z-index:100}#overlay h2{color:var(--beacon);font-size:32px;margin-bottom:12px;text-shadow:0 0 40px rgba(255,209,102,.5)}#overlay .subtitle{font-size:18px;margin-bottom:8px;color:var(--text)}#overlay p{color:var(--muted);font-size:14px}#overlay.hidden{display:none}#win{position:fixed;inset:0;background:rgba(7,10,22,.97);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:100}#win h2{color:var(--beacon);font-size:56px;text-shadow:0 0 50px rgba(255,209,102,.6);animation:beaconPulse 1s infinite}#win p{color:var(--muted);margin-top:16px;font-size:16px}#win.hidden{display:none}@media (orientation:landscape){.shell{padding:8px;flex-direction:row}.card{flex-direction:row}.hud{writing-mode:vertical-rl;text-orientation:mixed;padding:8px 6px;border-bottom:none;border-right:1px solid var(--stroke);min-width:60px}.hud .title{font-size:14px}.chips{flex-direction:column;gap:8px}.pill{font-size:10px;padding:4px 6px}.objective{position:absolute;top:8px;left:70px;right:8px;border-bottom:none;padding:6px;font-size:11px;background:var(--card);border-radius:8px;z-index:10}.objective strong{font-size:12px}.stage{flex:1;padding:4px;padding-top:40px}#grid{max-width:90%;max-height:90%}.controls{writing-mode:vertical-rl;text-orientation:mixed;padding:8px 6px;border-top:none;border-left:1px solid var(--stroke);min-width:70px}.dock{flex-direction:column;padding:6px;gap:4px}.btn{min-width:50px;padding:8px 6px;font-size:11px;writing-mode:horizontal-tb}.tap-hint{writing-mode:horizontal-tb;transform:rotate(90deg);transform-origin:center;margin-top:0;margin-left:10px;font-size:9px}.settings{flex-direction:column;padding:4px;gap:4px}.settings button,.settings label,.settings select{font-size:10px;padding:4px 6px;writing-mode:horizontal-tb}#train{max-height:0}#train.open{max-height:200px}}@media (orientation:portrait){.objective strong{font-size:14px}}@media (max-height:450px){.shell{padding:4px}.hud{padding:6px 8px;font-size:12px}.hud .title{font-size:12px}.objective{padding:4px;font-size:10px}.objective strong{font-size:11px}.stage{padding:2px}#grid{padding:3px;gap:1px}.cell{border-radius:2px}.icon{font-size:12px}.controls{padding:4px 6px}.dock{gap:3px;padding:4px}.btn{min-width:45px;padding:6px 8px;font-size:10px}.settings{padding:4px;gap:3px}.settings button,.settings label,.settings select{font-size:9px;padding:3px 6px}}.btn,.cell,.dock,.grid,.stage{-webkit-user-select:none;user-select:none;-webkit-touch-callout:none}</style></head><body><div id=debug style=display:none;position:fixed;top:0;left:0;background:rgba(0,0,0,.9);color:#0f0;font-family:monospace;font-size:10px;padding:8px;z-index:999;max-width:200px;line-height:1.3;pointer-events:none><div id=debug-content></div></div><div class=shell><div class=card><div class=hud><span class=title>‚üÅ PulseQuest</span><div class=chips><span class=pill>‚öì <strong id=steps>0</strong> steps</span></div></div><div class=objective><strong>üóº Find the Beacon</strong> ‚Äî Navigate by touch</div><div class=stage><div id=grid></div><div class=ping id=ping></div></div><div class=controls><div class=dock><button onclick='act("M")' class=btn>‚õµ Move<small>Tap Left</small></button> <button onclick='act("R")' class=btn>‚ü≥ Turn<small>Tap Right</small></button></div><div class=tap-hint style=text-align:center;font-size:10px;color:var(--muted);opacity:.5;margin-top:4px>Left: Move ‚Ä¢ Right: Turn ‚Ä¢ Both: Scan</div><div class=settings><label><input id=specV onchange=render() type=checkbox checked>Spectator</label> <label><input id=demoM onchange=togDemo() type=checkbox>Demo</label> <label><input id=muteAudio onchange=setVolume(this.checked?0:.4) type=checkbox>Mute</label> <select id=lvl onchange=loadLvl()><option value=0>Tutorial</option><option value=1>Hazards</option><option value=2>Challenge</option></select> <button onclick=togTrain()>Training</button></div><div id=train><div class=train-inner><button onclick='hapticImpact("light"),playMove()'>üåä Empty</button> <button onclick='hapticNotify("error"),playWall()'>üß± Wall</button> <button onclick='hapticNotify("success"),playWin()'>üóº Beacon</button> <button onclick=playSonar()>üì° Sonar</button><p>Test haptic + audio feedback</p></div></div></div></div></div><div id=overlay onclick=start() ontouchend=start()><h2>‚üÅ PulseQuest</h2><div class=subtitle>‚õµ Navigate ‚Ä¢ üóº Find beacon</div><p>Tap to begin ‚Ä¢ Left=Move ‚Ä¢ Right=Turn ‚Ä¢ Both=Scan</p></div><div class=hidden id=win><h2>üèÜ</h2><p>Beacon found! Press Enter to play again</p></div><script>!function(){const o=new Error("AXON VIOLATION: Network requests are forbidden");window.fetch=function(){throw o};const e=XMLHttpRequest.prototype;e.open=function(){throw o},e.send=function(){throw o},window.WebSocket=function(){throw o},console.log("[PulseQuest] Network guard active - offline mode enforced")}()</script><script>let ctx,hapticGain;function initHaptics(){ctx||(ctx=new(window.AudioContext||window.webkitAudioContext),hapticGain=ctx.createGain(),hapticGain.gain.value=1,hapticGain.connect(ctx.destination))}function resumeAudio(){ctx&&"suspended"===ctx.state&&ctx.resume()}function playRumble(t,e,i){ctx||initHaptics(),resumeAudio();const n=ctx.createOscillator(),c=ctx.createGain();n.type="sine",n.frequency.value=t,c.gain.setValueAtTime(i,ctx.currentTime),c.gain.exponentialRampToValueAtTime(.01,ctx.currentTime+e),n.connect(c).connect(hapticGain),n.start(),n.stop(ctx.currentTime+e)}window.hapticImpact=function(t="medium"){const e={light:{freq:60,dur:.05,int:.6},medium:{freq:45,dur:.08,int:.8},heavy:{freq:30,dur:.15,int:1}},i=e[t]||e.medium;playRumble(i.freq,i.dur,i.int)},window.hapticNotify=function(t="success"){ctx||initHaptics(),resumeAudio();const e={success:[{freq:50,dur:.06,int:.7,delay:0},{freq:70,dur:.08,int:.9,delay:.1}],warning:[{freq:40,dur:.05,int:.8,delay:0},{freq:40,dur:.05,int:.8,delay:.08},{freq:40,dur:.05,int:.8,delay:.16}],error:[{freq:25,dur:.12,int:1,delay:0},{freq:25,dur:.15,int:1,delay:.15}]};(e[t]||e.success).forEach(t=>{setTimeout(()=>playRumble(t.freq,t.dur,t.int),1e3*t.delay)})},window.hapticSelection=function(){playRumble(80,.02,.5)},window.setHapticVolume=function(t){hapticGain&&(hapticGain.gain.value=t)},document.addEventListener("touchstart",initHaptics,{once:!0}),document.addEventListener("click",initHaptics,{once:!0})</script><script>let ctx,masterGain,ambientNode;function initAudio(){ctx||(ctx=new(window.AudioContext||window.webkitAudioContext),masterGain=ctx.createGain(),masterGain.gain.value=.4,masterGain.connect(ctx.destination))}function playSonar(){ctx||initAudio();const t=ctx.createOscillator(),e=ctx.createGain();t.type="sine",t.frequency.setValueAtTime(800,ctx.currentTime),t.frequency.exponentialRampToValueAtTime(200,ctx.currentTime+.4),e.gain.setValueAtTime(.3,ctx.currentTime),e.gain.exponentialRampToValueAtTime(.01,ctx.currentTime+.5),t.connect(e).connect(masterGain),t.start(),t.stop(ctx.currentTime+.5)}function playMove(){ctx||initAudio();const t=ctx.createOscillator(),e=ctx.createGain();t.type="sine",t.frequency.value=520,e.gain.setValueAtTime(.15,ctx.currentTime),e.gain.exponentialRampToValueAtTime(.01,ctx.currentTime+.08),t.connect(e).connect(masterGain),t.start(),t.stop(ctx.currentTime+.08)}function playWall(){ctx||initAudio();const t=ctx.createOscillator(),e=ctx.createGain();t.type="triangle",t.frequency.setValueAtTime(80,ctx.currentTime),t.frequency.exponentialRampToValueAtTime(40,ctx.currentTime+.15),e.gain.setValueAtTime(.5,ctx.currentTime),e.gain.exponentialRampToValueAtTime(.01,ctx.currentTime+.15),t.connect(e).connect(masterGain),t.start(),t.stop(ctx.currentTime+.15)}function playHazard(){ctx||initAudio();const t=ctx.createOscillator(),e=ctx.createOscillator(),n=ctx.createGain(),a=ctx.createGain();t.type="sawtooth",t.frequency.value=180,e.type="sine",e.frequency.value=12,n.gain.value=.4,a.gain.value=.25,e.connect(n).connect(a.gain),t.connect(a).connect(masterGain),e.start(),t.start(),t.stop(ctx.currentTime+.35),e.stop(ctx.currentTime+.35)}function playReset(){ctx||initAudio();const t=ctx.createOscillator(),e=ctx.createGain();t.type="triangle",t.frequency.setValueAtTime(60,ctx.currentTime),t.frequency.exponentialRampToValueAtTime(25,ctx.currentTime+.3),e.gain.setValueAtTime(.6,ctx.currentTime),e.gain.exponentialRampToValueAtTime(.01,ctx.currentTime+.3),t.connect(e).connect(masterGain),t.start(),t.stop(ctx.currentTime+.3)}function playWin(){ctx||initAudio(),[523,659,784,1047].forEach((t,e)=>{const n=ctx.createOscillator(),a=ctx.createGain();n.type="sine",n.frequency.value=t;const i=ctx.currentTime+.12*e;a.gain.setValueAtTime(0,i),a.gain.linearRampToValueAtTime(.25,i+.03),a.gain.exponentialRampToValueAtTime(.01,i+.35),n.connect(a).connect(masterGain),n.start(i),n.stop(i+.35)})}function playTurn(){ctx||initAudio();const t=.015*ctx.sampleRate,e=ctx.createBuffer(1,t,ctx.sampleRate),n=e.getChannelData(0);for(let e=0;e<t;e++)n[e]=2*Math.random()-1;const a=ctx.createBufferSource(),i=ctx.createGain();a.buffer=e,i.gain.setValueAtTime(.12,ctx.currentTime),i.gain.exponentialRampToValueAtTime(.01,ctx.currentTime+.015),a.connect(i).connect(masterGain),a.start()}function startAmbient(){if(ctx||initAudio(),ambientNode)return;const t=2*ctx.sampleRate,e=ctx.createBuffer(1,t,ctx.sampleRate),n=e.getChannelData(0);for(let e=0;e<t;e++)n[e]=2*Math.random()-1;ambientNode=ctx.createBufferSource(),ambientNode.buffer=e,ambientNode.loop=!0;const a=ctx.createBiquadFilter();a.type="lowpass",a.frequency.value=120;const i=ctx.createGain();i.gain.value=.06,ambientNode.connect(a).connect(i).connect(masterGain),ambientNode.start()}function stopAmbient(){ambientNode&&(ambientNode.stop(),ambientNode=null)}function setVolume(t){masterGain&&(masterGain.gain.value=t)}window.initAudio=initAudio,window.playSonar=playSonar,window.playMove=playMove,window.playWall=playWall,window.playHazard=playHazard,window.playReset=playReset,window.playWin=playWin,window.playTurn=playTurn,window.startAmbient=startAmbient,window.stopAmbient=stopAmbient,window.setVolume=setVolume</script><script>const LEVELS=["WWWWWWWWWWWWWWWWWWWWW,WEEEEEWWWWWEEEEEEEWW,WEWWWEWWWWWEWWWWWEWW,WEWWWEEEEEEEWWWWWEWW,WEWWWWWWWWWWWEEEEEWW,WEEEEEEEEEEEEEWWWBEW,WWWWWWWWWWWWWWWWWWWWW","WWWWWWWWWWWWWWWWWWWWW,WEEEEEWEEEWEEEEEEEEWW,WEWWWEWWWWWEWWWWWEWW,WEWWWEEEEEEEWWWWWEWW,WEWWWWWWWWWWWEEEEEWW,WEEEEEEEEEEEEEWWWBEW,WWWWWWWWWWWWWWWWWWWWW","WWWWWWWWWWWWWWWWWWWWW,WEEEEEWEEEWEEEEEEEEWW,WEWWWEWWWWWEWEWWWEWW,WEEWEWEEEEEEEWWWBEWW,WEWWWWWWWWWWWEEEWEWW,WEEEEEEEEEEEEEEEEEWW,WWWWWWWWWWWWWWWWWWWWW"],DIR=["N","E","S","W"],DX=[0,1,0,-1],DY=[-1,0,1,0],ARR=["‚ñ≤","‚ñ∫","‚ñº","‚óÄ"],ICONS={E:"",W:"üß±",B:"üóº"};let map,px,py,pd,steps,lastScan,started=!1;function parse(e){return e.split(",").map(e=>e.split(""))}function loadLvl(){const e=+document.getElementById("lvl").value;map=parse(LEVELS[e]),px=1,py=1,pd=1,steps=0,lastScan=null,document.getElementById("win").classList.add("hidden"),render(),updStats()}function tile(e,t){return t>=0&&t<7&&e>=0&&e<21?map[t][e]:"W"}function ahead(){return{x:px+DX[pd],y:py+DY[pd]}}function leftT(){const e=(pd+3)%4;return{x:px+DX[e],y:py+DY[e]}}function rightT(){const e=(pd+1)%4;return{x:px+DX[e],y:py+DY[e]}}function render(){const e=document.getElementById("grid"),t=document.getElementById("specV").checked;e.innerHTML="";for(let W=0;W<7;W++)for(let n=0;n<21;n++){const E=document.createElement("div"),o=map[W][n];E.className="cell "+o;const i=Math.abs(n-px)+Math.abs(W-py);!t&&i>2&&E.classList.add("fog"),n===px&&W===py?E.innerHTML=`<span class="player">${ARR[pd]}</span>`:ICONS[o]&&(E.innerHTML=`<span class="icon">${ICONS[o]}</span>`),e.appendChild(E)}}function updStats(){document.getElementById("steps").textContent=steps}function flash(e){const t=document.querySelectorAll(".cell");e.forEach(([e,W])=>{e>=0&&e<21&&W>=0&&W<7&&t[21*W+e].classList.add("scan")});const W=document.getElementById("ping");W.classList.remove("active"),W.offsetWidth,W.classList.add("active"),setTimeout(()=>{t.forEach(e=>e.classList.remove("scan"))},600)}function act(e){if(started){if("M"===e){const{x:e,y:t}=ahead(),W=tile(e,t);if("W"===W)return hapticNotify("error"),void playWall();px=e,py=t,steps++,"E"===W&&(hapticImpact("light"),playMove()),"B"===W&&(hapticNotify("success"),playWin(),document.getElementById("win").classList.remove("hidden"))}else if("L"===e)pd=(pd+3)%4,hapticSelection(),playTurn();else if("R"===e)pd=(pd+1)%4,hapticSelection(),playTurn();else if("S"===e){const e=tile(ahead().x,ahead().y),t=tile(leftT().x,leftT().y),W=tile(rightT().x,rightT().y);lastScan={f:e,l:t,r:W},hapticImpact("medium"),playSonar(),flash([[ahead().x,ahead().y],[leftT().x,leftT().y],[rightT().x,rightT().y]])}else"P"===e&&(hapticImpact("light"),playSonar());render(),updStats()}}function start(){document.getElementById("overlay").classList.add("hidden"),started=!0,loadLvl()}function togTrain(){document.getElementById("train").classList.toggle("open")}function togDemo(){const e=document.getElementById("demoM").checked;document.getElementById("specV").checked=e,document.querySelector(".objective").innerHTML=e?'<strong style="font-size:22px">Press SCAN ‚Üí then MOVE</strong>':"<strong>üóº Find the Beacon</strong> ‚Äî Navigate by touch",render()}function performDistanceScan(){let e=19,t=5;for(let W=0;W<7;W++)for(let n=0;n<21;n++)if("B"===map[W][n]){e=n,t=W;break}const W=e-px,n=t-py,E=Math.sqrt(W*W+n*n),o=Math.min(E/25,1),i=800-Math.log(1+9*o)/Math.log(10)*700;flash([[px,py]]),navigator.vibrate?navigator.vibrate(Math.round(i)):hapticImpact("medium"),playSonar(),console.log(`Distance to beacon: ${E.toFixed(1)} units, vibration: ${Math.round(i)}ms`)}let leftTouch=!1,rightTouch=!1,touchTimeout=null;document.addEventListener("touchstart",e=>{started?(e.preventDefault(),Array.from(e.touches).forEach(e=>{e.clientX<window.innerWidth/2?leftTouch=!0:rightTouch=!0}),leftTouch&&rightTouch&&(clearTimeout(touchTimeout),touchTimeout=setTimeout(()=>{performDistanceScan()},200))):e.target.closest("#overlay")},{passive:!1}),document.addEventListener("touchend",e=>{started?(e.preventDefault(),clearTimeout(touchTimeout),leftTouch&&!rightTouch?act("M"):rightTouch&&!leftTouch&&act("R"),leftTouch=!1,rightTouch=!1):e.target.closest("#overlay")},{passive:!1}),document.addEventListener("touchcancel",()=>{clearTimeout(touchTimeout),leftTouch=!1,rightTouch=!1}),document.addEventListener("keydown",e=>{if("D"===e.key&&e.shiftKey)return debugVisible=!debugVisible,debugEl.style.display=debugVisible?"block":"none",void(debugVisible&&updateDebug());if("Enter"===e.key)return void(started?loadLvl():start());const t={w:"M",arrowup:"M",a:"L",arrowleft:"L",d:"R",arrowright:"R",s:"S",shift:"S",r:"P"}[e.key.toLowerCase()];t&&act(t)});let debugVisible=!1;const debugEl=document.getElementById("debug"),debugContent=document.getElementById("debug-content");function updateDebug(){if(!debugVisible)return;const e=e=>getComputedStyle(document.documentElement).getPropertyValue(`--sa${e}`)||"0px";debugContent.innerHTML=`\nW: ${window.innerWidth}px\nH: ${window.innerHeight}px\nDPR: ${window.devicePixelRatio}\nOrient: ${screen.orientation?.type||"unknown"}\nSAT: ${e("t")}\nSAR: ${e("r")}\nSAB: ${e("b")}\nSAL: ${e("l")}\nGrid: ${document.getElementById("grid")?.offsetWidth||0}√ó${document.getElementById("grid")?.offsetHeight||0}\n      `.trim()}window.addEventListener("resize",updateDebug),window.addEventListener("orientationchange",()=>{setTimeout(updateDebug,300)}),loadLvl()</script></body></html>